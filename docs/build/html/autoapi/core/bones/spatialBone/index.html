

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>core.bones.spatialBone &mdash; ViUR Core 3.0.0-b1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> ViUR Core
          

          
          </a>

          
            
            
              <div class="version">
                3.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">ViUR Core</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc_start/index.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc_guide/index.html">Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc_tutorial/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ViUR Core</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li><code class="xref py py-mod docutils literal notranslate"><span class="pre">core.bones.spatialBone</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../_sources/autoapi/core/bones/spatialBone/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-core.bones.spatialBone">
<span id="core-bones-spatialbone"></span><h1><a class="reference internal" href="#module-core.bones.spatialBone" title="core.bones.spatialBone"><code class="xref py py-mod docutils literal notranslate"><span class="pre">core.bones.spatialBone</span></code></a><a class="headerlink" href="#module-core.bones.spatialBone" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Permalink to this headline">¶</a></h2>
<div class="section" id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#core.bones.spatialBone.spatialBone" title="core.bones.spatialBone.spatialBone"><code class="xref py py-obj docutils literal notranslate"><span class="pre">spatialBone</span></code></a></p></td>
<td><p>Allows to query by Elements close to a given position.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#core.bones.spatialBone.haversine" title="core.bones.spatialBone.haversine"><code class="xref py py-obj docutils literal notranslate"><span class="pre">haversine</span></code></a>(lat1, lng1, lat2, lng2)</p></td>
<td><p>Calculates the distance between two points on Earth given by (lat1,lng1) and (lat2, lng2) in Meter.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt id="core.bones.spatialBone.haversine">
<code class="sig-prename descclassname"><span class="pre">core.bones.spatialBone.</span></code><code class="sig-name descname"><span class="pre">haversine</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lat1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lng1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lng2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.haversine" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the distance between two points on Earth given by (lat1,lng1) and (lat2, lng2) in Meter.
See <a class="reference external" href="https://en.wikipedia.org/wiki/Haversine_formula">https://en.wikipedia.org/wiki/Haversine_formula</a></p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Distance in Meter</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="core.bones.spatialBone.spatialBone">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">core.bones.spatialBone.</span></code><code class="sig-name descname"><span class="pre">spatialBone</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">boundsLat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundsLng</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gridDimensions</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.spatialBone" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">viur.core.bones.baseBone</span></code></p>
<p>Allows to query by Elements close to a given position.
Prior to use, you must specify for which region of the map the index should be build.
This region should be as small as possible for best accuracy. You cannot use the whole world, as
no boundary wraps are been performed.
GridDimensions specifies into how many sub-regions the map will be split. Results further away than the
size of these sub-regions won’t be considered within a search by this algorithm.</p>
<dl class="simple">
<dt>Example:</dt><dd><p>If you use this bone to query your data for the nearest pubs, you might want to this algorithm
to consider results up to 100km distance, but not results that are 500km away.
Setting the size of these sub-regions to roughly 100km width/height allows this algorithm
to exclude results further than 200km away on database-query-level, therefore drastically
improving performance and reducing costs per query.</p>
</dd>
</dl>
<p>Example region: Germany: boundsLat=(46.988, 55.022), boundsLng=(4.997, 15.148)</p>
<dl class="py attribute">
<dt id="core.bones.spatialBone.spatialBone.type">
<code class="sig-name descname"><span class="pre">type</span></code><em class="property"> <span class="pre">=</span> <span class="pre">spatial</span></em><a class="headerlink" href="#core.bones.spatialBone.spatialBone.type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="core.bones.spatialBone.spatialBone.getGridSize">
<code class="sig-name descname"><span class="pre">getGridSize</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.spatialBone.getGridSize" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the size of our sub-regions in (fractions-of-latitude, fractions-of-longitude)</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>(float, float)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="core.bones.spatialBone.spatialBone.isInvalid">
<code class="sig-name descname"><span class="pre">isInvalid</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.spatialBone.isInvalid" title="Permalink to this definition">¶</a></dt>
<dd><p>Tests, if the point given by ‘value’ is inside our boundaries.
We’ll reject all values outside that region.
:param value: (latitude, longitude) of the location of this entry.
:type value: (float, float)
:return: An error-description or False if the value is valid
:rtype: str | False</p>
</dd></dl>

<dl class="py method">
<dt id="core.bones.spatialBone.spatialBone.singleValueSerialize">
<code class="sig-name descname"><span class="pre">singleValueSerialize</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skel</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">SkeletonInstance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parentIndexed</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.spatialBone.singleValueSerialize" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="core.bones.spatialBone.spatialBone.singleValueUnserialize">
<code class="sig-name descname"><span class="pre">singleValueUnserialize</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skel</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">viur.core.skeleton.SkeletonInstance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.spatialBone.singleValueUnserialize" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="core.bones.spatialBone.spatialBone.parseSubfieldsFromClient">
<code class="sig-name descname"><span class="pre">parseSubfieldsFromClient</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.spatialBone.parseSubfieldsFromClient" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="core.bones.spatialBone.spatialBone.isEmpty">
<code class="sig-name descname"><span class="pre">isEmpty</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawValue</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.spatialBone.isEmpty" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="core.bones.spatialBone.spatialBone.getEmptyValue">
<code class="sig-name descname"><span class="pre">getEmptyValue</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#core.bones.spatialBone.spatialBone.getEmptyValue" title="Permalink to this definition">¶</a></dt>
<dd><p>If you need a special marker for empty, use 91.0, 181.0.
These are both out of range for Latitude (-90, +90) and Longitude (-180, 180) but will be accepted
by Vi and Admin</p>
</dd></dl>

<dl class="py method">
<dt id="core.bones.spatialBone.spatialBone.singleValueFromClient">
<code class="sig-name descname"><span class="pre">singleValueFromClient</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">origData</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.spatialBone.singleValueFromClient" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads a value from the client.
If this value is valid for this bone,
store this value and return None.
Otherwise our previous value is
left unchanged and an error-message
is returned.
:param name: Our name in the skeleton
:type name: str
:param data: <em>User-supplied</em> request-data
:type data: dict
:returns: None or String</p>
</dd></dl>

<dl class="py method">
<dt id="core.bones.spatialBone.spatialBone.buildDBFilter">
<code class="sig-name descname"><span class="pre">buildDBFilter</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">skel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbFilter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawFilter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.spatialBone.buildDBFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses the searchfilter a client specified in his Request into
something understood by the datastore.
This function must:</p>
<blockquote>
<div><ul class="simple">
<li><p>Ignore all filters not targeting this bone</p></li>
<li><dl class="simple">
<dt>Safely handle malformed data in rawFilter</dt><dd><p>(this parameter is directly controlled by the client)</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p>For detailed information, how this geo-spatial search works, see the ViUR documentation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – The property-name this bone has in its Skeleton (not the description!)</p></li>
<li><p><strong>skel</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">server.skeleton.Skeleton</span></code>) – The <code class="xref py py-class docutils literal notranslate"><span class="pre">server.db.Query</span></code> this bone is part of</p></li>
<li><p><strong>dbFilter</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">server.db.Query</span></code>) – The current <code class="xref py py-class docutils literal notranslate"><span class="pre">server.db.Query</span></code> instance the filters should be applied to</p></li>
<li><p><strong>rawFilter</strong> (<em>dict</em>) – The dictionary of filters the client wants to have applied</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The modified <code class="xref py py-class docutils literal notranslate"><span class="pre">server.db.Query</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="core.bones.spatialBone.spatialBone.calculateInternalMultiQueryLimit">
<code class="sig-name descname"><span class="pre">calculateInternalMultiQueryLimit</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbQuery</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targetAmount</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.spatialBone.calculateInternalMultiQueryLimit" title="Permalink to this definition">¶</a></dt>
<dd><p>Tells <code class="xref py py-class docutils literal notranslate"><span class="pre">server.db.Query</span></code> How much entries should be fetched in each subquery.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>targetAmount</strong> (<em>int</em>) – How many entries shall be returned from db.Query</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The amount of elements db.Query should fetch on each subquery</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="core.bones.spatialBone.spatialBone.customMultiQueryMerge">
<code class="sig-name descname"><span class="pre">customMultiQueryMerge</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lng</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dbFilter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">result</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">targetAmount</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.spatialBone.customMultiQueryMerge" title="Permalink to this definition">¶</a></dt>
<dd><p>Randomly returns ‘targetAmount’ elements from ‘result’</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dbFilter</strong> – The db.Query calling this function</p></li>
<li><p><strong>result</strong> (list of list of <code class="xref py py-class docutils literal notranslate"><span class="pre">server.db.Entity</span></code>) – The list of results for each subquery we’ve run</p></li>
<li><p><strong>targetAmount</strong> (<em>int</em>) – How many results should be returned from db.Query</p></li>
</ul>
</dd>
<dt class="field-even">Type</dt>
<dd class="field-even"><p>dbFilter: server.db.Query</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>List of elements which should be returned from db.Query</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>list of <code class="xref py py-class docutils literal notranslate"><span class="pre">server.db.Entity</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="core.bones.spatialBone.spatialBone.setBoneValue">
<code class="sig-name descname"><span class="pre">setBoneValue</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valuesCache</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boneName</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">append</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#core.bones.spatialBone.spatialBone.setBoneValue" title="Permalink to this definition">¶</a></dt>
<dd><p>Set our value to ‘value’.
Santy-Checks are performed; if the value is invalid, we flip our value back to its original
(default) value and return false.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>valuesCache</strong> (<em>dict</em>) – Dictionary with the current values from the skeleton we belong to</p></li>
<li><p><strong>boneName</strong> (<em>object</em>) – The Bone which should be modified</p></li>
<li><p><strong>value</strong> – The value that should be assigned. It’s type depends on the type of that bone</p></li>
<li><p><strong>append</strong> (<em>bool</em>) – If true, the given value is appended to the values of that bone instead of
replacing it. Only supported on bones with multiple=True</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Wherever that operation succeeded or not.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Mausbrand Informationssysteme GmbH.
      <span class="lastupdated">
        Last updated on Mar 12, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>